var mod=(()=>{var i=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var b=(t,e)=>{for(var r in e)i(t,r,{get:e[r],enumerable:!0})},x=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of h(e))!w.call(t,s)&&s!==r&&i(t,s,{get:()=>e[s],enumerable:!(n=g(e,s))||n.enumerable});return t};var v=t=>x(i({},"__esModule",{value:!0}),t);var R={};b(R,{functionMapping:()=>y});function u(t){let e=atob(t),r=e.length,n=new Uint8Array(r);for(let s=0;s<r;s++)n[s]=e.charCodeAt(s);return n}function M(t,e){return syscall("sandboxFetch.fetch",t,e)}function f(){globalThis.fetch=async function(t,e){let r=await M(t,e&&{method:e.method,headers:e.headers,body:e.body});return new Response(r.base64Body?u(r.base64Body):null,{status:r.status,headers:r.headers})}}typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var l=new Map,c=0;function a(t){self.postMessage(t)}self.syscall=async(t,...e)=>await new Promise((r,n)=>{c++,l.set(c,{resolve:r,reject:n}),a({type:"sys",id:c,name:t,args:e})});function d(t,e){self.addEventListener("message",r=>{(async()=>{let n=r.data;switch(n.type){case"inv":{let s=t[n.name];if(!s)throw new Error(`Function not loaded: ${n.name}`);try{let o=await Promise.resolve(s(...n.args||[]));a({type:"invr",id:n.id,result:o})}catch(o){console.error(o),a({type:"invr",id:n.id,error:o.message})}}break;case"sysr":{let s=n.id,o=l.get(s);if(!o)throw Error("Invalid request id");l.delete(s),n.error?o.reject(new Error(n.error)):o.resolve(n.result)}break}})().catch(console.error)}),a({type:"manifest",manifest:e})}f();function p(t){return/https:\/\/twitter.com\/[^\/]+\/status\/\d+/.exec(t)?[{id:"tweet-unfurl",name:"Tweet content"}]:[]}function P(t){return t.replace(/<br>/g," ").replace(/<p>/g," ").replace(/<\/?[^>]+(>|$)/g,"").split("&mdash;")[0].trim()}async function m(t){let e=await fetch(`https://publish.twitter.com/oembed?url=${t}`);if(e.status!==200)throw console.error(await e.text()),new Error("Failed to fetch oEmbed result");let r=await e.json();return`[${r.author_name}](${t}):
 > ${P(r.html)}`}var y={tweetUnfurlOptions:p,tweetUnfurl:m},U={name:"twitter",version:.1,functions:{tweetUnfurlOptions:{path:"./unfurl.ts:unfurlOptions",events:["unfurl:options"]},tweetUnfurl:{path:"./unfurl.ts:unfurlTweet",events:["unfurl:tweet-unfurl"]}},assets:{}};d(y,U);return v(R);})();
